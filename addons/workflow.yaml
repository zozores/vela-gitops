---
apiVersion: core.oam.dev/v1alpha1
kind: WorkflowRun
metadata:
  name: wf-addons
  namespace: addons
  annotations:
    workflowrun.oam.dev/debug: "true"
    app.oam.dev/source-of-truth: from-velaux
spec:
  workflowSpec:
    steps:
      - name: apply-external-secrets
        type: apply-app
        properties:
          ref:
            name: external-secrets
            key: application.yaml
            type: configMap
      
      - name: suspend
        type: suspend
        timeout: 5m

      - name: apply-tailscale
        type: apply-app
        dependsOn:
          - apply-external-secrets
        properties:
          ref:
            name: tailscale
            key: application.yaml
            type: configMap

      - name: suspend
        type: suspend
        timeout: 5m

      - name: apply-ingress-nginx
        type: apply-app
        dependsOn:
          - apply-tailscale
        properties:
          ref:
            name: ingress-nginx
            key: application.yaml
            type: configMap

      - name: suspend
        type: suspend
        timeout: 5m

      - name: apply-external-dns
        type: apply-app
        dependsOn:
          - apply-external-secrets
          - apply-ingress-nginx
        properties:
          ref:
            name: external-dns
            key: application.yaml
            type: configMap